<!DOCTYPE html>
<html lang="fr">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900&amp;subset=latin-ext" rel="stylesheet">
<style>
html, body {
    margin: 0;
    padding: 0;
}

body {
    width: 100%;
    height: 100vh;
    display: flex;
	flex-direction: column;
	flex-wrap: nowrap;
	justify-content: flex-start;
	align-items: stretch;
	align-content: stretch;
    font-family: "Lato", sans-serif;
}

#date {
    font-weight: bold;
    width: 75.8%;
    font-size: 5vw;
    align-self: stretch;
    background-color: black;
    color: white;
}

#time {
    font-size: 5.4vw;
    width: 24.2%;
    align-self: stretch;
}

#time #seconds {
    font-weight: 300;
}

#main {
    background-color: black;
    height: 85%;
    display: flex;
	flex-direction: row;
	flex-wrap: nowrap;
	justify-content: flex-start;
	align-items: stretch;
	align-content: stretch;
}

#top {
    display: flex;
	flex-direction: row;
	flex-wrap: nowrap;
	justify-content: space-between;
	align-items: center;
	align-content: stretch;
    height: 15%;
}

#meteo {
    width: 24.2%;
    background-color: white;
}

#slide {
    width: 75.8%;
    overflow: hidden;
}

#slide iframe {
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.weatherCard h1 {
        margin-bottom: 0;
        margin-top: 5px;
        padding-left: 5px;
        color: #11AAD3;
}

#tomorrowWeather h1 {
    color: black;
}

#tomorrowAMWeather,
#tomorrowPMWeather {
    width: 50%;
}

#tomorrowAMWeather {
    border-right: 2px solid #E2F6F7;
}

#tomorrowWeather .wrapWeatherSpecial {
    background-color: white;
    display: flex;
	flex-direction: row;
	flex-wrap: nowrap;
	justify-content: center;
	align-items: stretch;
	align-content: stretch;
}

#tomorrowWeather .weatherSpecial {
    display: flex;
	flex-direction: column;
	flex-wrap: nowrap;
	justify-content: flex-start;
	align-items: stretch;
	align-content: stretch;
    padding: 10px;
}

#tomorrowWeather .specialTomorrow {
    display: flex;
	flex-direction: row;
	flex-wrap: nowrap;
	justify-content: flex-start;
	align-items: stretch;
	align-content: stretch;
}

#tomorrowWeather .tempIcon {
    height: 5vw;
    padding-right: 10px;
}

#tomorrowWeather .period {
    font-size: 1.2vw;
    padding-bottom: 10px;
}

#tomorrowWeather .minMax {
    display: flex;
	flex-direction: column;
	flex-wrap: nowrap;
	justify-content: space-around;
	align-items: stretch;
	align-content: stretch;
    font-size: 1.7vw;
    font-weight: 700;
}

#tomorrowWeather .tempMin {
    color: #11AAD3;
}

#tomorrowWeather .tempText {
    font-size: 1vw;
    padding-top: 10px;
}

.weatherCard .weatherTop  {
    background-color: #11AAD3;
    color: white;
    display: flex;
	flex-direction: column;
	flex-wrap: nowrap;
	justify-content: center;
	align-items: center;
	align-content: stretch;
    padding: 10px;
}

.weatherCard .weatherTop .temp {
    font-size: 4.5vw;
    font-weight: 500;
}

.weatherCard .weatherTop .tempText {
    font-size: 1.4vw;
    font-weight: 300;
}

.weatherCard .weatherTop .tempIcon {
    width: 6vw;
}

.weatherCard .weatherBottom {
    background-color: white;
    color: black;
    display: flex;
    flex-direction: row;
	flex-wrap: nowrap;
	justify-content: space-around;
	align-items: stretch;
	align-content: stretch;
    padding: 10px;
}

.weatherCard .weatherBottom img {
    width: 1vw;
    padding-right: 10px;
}

.weatherCard .weatherBottom .more {
    display: flex;
	flex-direction: row;
	flex-wrap: nowrap;
	justify-content: space-around;
	align-items: center;
	align-content: stretch;
    font-size: 1.4vw;
    font-weight: 400;
}

#temperature {
    display: flex;
	flex-direction: row;
	flex-wrap: nowrap;
	justify-content: space-around;
	align-items: center;
	align-content: stretch;
}




</style>
</head>

<body>


    <div id="top">
        <div id="date"></div>
        <div id="time">
            <span id="hourMinutes"></span><span id="seconds"></span>
        </div>
    </div>

    <div id="main">
        <div id="slide">
            <iframe id="googleSlide" src="" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>
        </div>

        <div id="meteo">
            <div id="currentWeather" class="weatherCard">
                <h1>Maintenant</h1>
                <div class="weatherTop">
                    <div id="temperature">
                        <div class="temp"></div>
                        <img class="tempIcon" src="" />
                    </div>
                    <div class="tempText"></div>
                </div>
                <div class="weatherBottom">
                    <div class="more"><img src="icons/humidity.svg" /><span class="humidity"></span></div>
                    <div class="more"><img src="icons/wind.svg" /><span class="windSpeed"></span></div>
                    <div class="more"><img src="icons/rain.svg" /><span class="rain"></span></div>
                </div>
            </div>

            <div id="nextHourWeather" class="weatherCard">
                <h1>Dans une heure</h1>
                <div class="weatherTop">
                    <div id="temperature">
                        <div class="temp"></div>
                        <img class="tempIcon" src="" />
                    </div>
                    <div class="tempText"></div>
                </div>
                <div class="weatherBottom">
                    <div class="more"><img src="icons/humidity.svg" /><span class="humidity"></span></div>
                    <div class="more"><img src="icons/wind.svg" /><span class="windSpeed"></span></div>
                    <div class="more"><img src="icons/rain.svg" /><span class="rain"></span></div>
                </div>
            </div>

            <div id="tomorrowWeather" class="weatherCard">

                <h1>Demain</h1>

                <div class="wrapWeatherSpecial">
                    <div id="tomorrowAMWeather" class="weatherSpecial">
                        <div class="period">Matin</div>
                        <div class="specialTomorrow">
                            <img class="tempIcon" src="" />
                            <div class="minMax">
                                <div class="tempMin"></div>
                                <div class="tempMax"></div>
                            </div>
                        </div>
                        <div class="tempText"></div>
                    </div>

                    <div id="tomorrowPMWeather" class="weatherSpecial">
                        <div class="period">Après-midi</div>
                        <div class="specialTomorrow">
                            <img class="tempIcon" src="" />
                            <div class="minMax">
                                <div class="tempMin"></div>
                                <div class="tempMax"></div>
                            </div>
                        </div>
                        <div class="tempText"></div>
                    </div>
                </div>

            </div>

        </div>
    </div>



<script>

function translateDate(date, lang = "fr") {

    var jours = {"fr": {
        0: "Dimanche",
        1: "Lundi",
        2: "Mardi",
        3: "Mercredi",
        4: "Jeudi",
        5: "Vendredi",
        6: "Samedi"
    }};

    var mois = {"fr": {
        0: "janvier",
        1: "février",
        2: "mars",
        3: "avril",
        4: "mai",
        5: "juin",
        6: "juillet",
        7: "août",
        8: "septembre",
        9: "octobre",
        10: "novembre",
        11: "décembre"
    }};

	var dateText = jours[lang][date.getDay()] + " ";   // nom du jour
    dateText += date.getDate() + " ";   // numero du jour
    dateText += mois[lang][date.getMonth()] + " ";   // mois
    dateText += date.getFullYear();
    return dateText;
}

function translateTempText(symbol, lang = "fr") {

	var translateTempText = {"fr":
        {
        1: "Ensoleillé",
    	2: "Légèrement couvert",
    	3: "Partiellement nuageux",
    	4: "Nuageux",
    	5: "Ensoleillé avec pluie légère",
    	6: "Ensoleillé avec tonnerre",
    	7: "Ensoleillé avec neige fondue",
    	8: "Ensoleillé avec neige",
    	9: "Pluie légère",
    	10: "Pluvieux",
    	11: "Orage pluvieux",
    	12: "Neige fondue",
    	13: "Neigeux",
    	14: "Enneigé avec tonnerre",
    	15: "Brumeux",
    	20: "Ensoleillé avec grêle",
    	21: "Neigeux avec tonnerre",
    	22: "Pluie légère et orageuse",
    	23: "Grésil orageux",
    	24: "Ensoleillé et bruine orageuse",
    	25: "Ensoleillé et orage",
    	26: "Ensoleillé et léger grésil orageux",
    	27: "Ensoleillé et gros grésil orageux",
    	28: "Ensoleillé et léger orage neigeux",
    	29: "Ensoleillé et gros orage neigeux",
    	30: "Bruine orageuse",
    	31: "Léger grésil orageux",
    	32: "Gros grésil orageux",
    	33: "Léger orage neigeux",
    	34: "Gros orage neigeux",
    	40: "Ensoleillé et bruineux",
    	41: "Ensoleillé et pluvieux",
    	42: "Ensoleillé avec léger grésil",
    	43: "Ensoleillé avec grésil",
    	44: "Ensoleillé avec petit manteau neigeux",
    	45: "Ensoleillé avec fortes chutes de neige",
    	46: "Bruineux",
    	47: "Léger grésil",
    	48: "Grésil",
    	49: "Petit manteau neigeux",
    	50: "Fortes chutes de neige"
        }
	};

	return translateTempText[lang][symbol];

}

function speedMstoKmh(ms) {
	var kmh = ms * 3.6;
	return kmh;
}


function getDateTime() {
	// on recupere la date
    var date = new Date();
    document.getElementById("date").innerHTML = translateDate(date);

    var time = date.toLocaleTimeString("fr-FR"); // hh:mm:ss
    var timeSplit = time.split(":");
	document.getElementById("hourMinutes").innerHTML = timeSplit[0]+":"+timeSplit[1];
    document.getElementById("seconds").innerHTML = ":"+timeSplit[2];

    setTimeout(getDateTime, 1000); // mise à jour du contenu "timer" toutes les secondes
}

getDateTime();













// var request = new XMLHttpRequest();
// //
// request.open('GET', 'https://api.openweathermap.org/data/2.5/weather?lat=45.179055&lon=5.731420&units=metric&lang=fr&appid=43b1606a5f9ea838c98f1e6dd19a1dc5', true);
// request.onload = function () {

//   // Begin accessing JSON data here
//   var data = JSON.parse(this.response);

//   if (request.status >= 200 && request.status < 400) {
// 	var name = data.name;
// 	var temp = Math.round(data.main.temp);
// 	var tempMin = data.main.temp_min;
// 	var tempMax = data.main.temp_max;
// 	var windSpeed_ms = data.wind.speed;
// 	var windSpeed_kmh = Math.round(3.6 * windSpeed_ms);
// 	var type = data.weather[0].description;
// 	var icon = data.weather[0].icon;

//     console.log(name);
// 	console.log(temp+"°c");
// 	console.log(tempMin+"°c min");
// 	console.log(tempMax+"°c max");
// 	console.log(windSpeed_kmh+" km/h");
// 	console.log(type);
// 	console.log(icon);
// 	console.log(data);

// 	document.getElementById('temp').innerHTML = temp+"°c";
// 	document.getElementById('tempIcon').src="icons/"+icon+".svg";
//   } else {
//     console.log('error');
//   }
// };

// request.send();

function setTimeTo(date, hours = 0, minutes = 0, seconds = 0, milliseconds = 0) {
	if (hours != 0) {
		date.setUTCHours(hours);
	}
	date.setMinutes(minutes);
	date.setSeconds(seconds);
	date.setMilliseconds(milliseconds);

	return date;
}



class Weather {
	constructor(from, to, temp, tempMin, tempMax, windSpeed, humidity, rain, symbol, tempText) {
		this.from = from;
		this.to = to;
		this.temp = temp;
		this.tempMin = tempMin;
		this.tempMax = tempMax;
		this.windSpeed = windSpeed;
        this.humidity = humidity;
		this.rain = rain;
		this.symbol = symbol;
		this.tempText = tempText;
	}
}

function setWeatherIcon(child, symbol) {
    var date = new Date();
    var lever = setTimeTo(new Date(), 6, 30, 0, 0);
    var coucher = setTimeTo(new Date(), 17, 30, 0, 0);
    var isNight = 0;

    if (date.getTime() <= lever.getTime() || date.getTime() >= coucher.getTime()) {
        isNight = 1;
    }

    return document.getElementById(child).getElementsByClassName('tempIcon')[0].src = "https://api.met.no/weatherapi/weathericon/1.1/?symbol="+symbol+"&is_night="+isNight+"&content_type=image%2Fsvg%2Bxml";
}

var currentWeather = new Weather();
var nextHourWeather = new Weather();
var tomorrowAMWeather = new Weather();
var tomorrowPMWeather = new Weather();

function refreshMeteo() {

    var now = setTimeTo(new Date());
    var afterOneHour = setTimeTo(new Date());
    var tomorrow06 = setTimeTo(new Date(), 6); // 06hOO
    var tomorrow12 = setTimeTo(new Date(), 12); // 12h00
    var tomorrow18 = setTimeTo(new Date(), 18); // 18h00

    afterOneHour.setUTCHours( now.getUTCHours() + 1);
    tomorrow06.setUTCDate( now.getUTCDate() + 1);
    tomorrow12.setUTCDate( now.getUTCDate() + 1);
    tomorrow18.setUTCDate( now.getUTCDate() + 1);

    // Using Norwegian Meteo API
    var request = new XMLHttpRequest();
    //

    request.open('GET', 'https://api.met.no/weatherapi/locationforecast/1.9/?lat=45.17921&lon=5.73145&msl=215', true);
    request.setRequestHeader('Accept', 'application/json');
    request.onload = function () {

      // Begin accessing JSON data here

      if (request.status >= 200 && request.status < 400) {

    	var from = new Array();
    	var to = new Array();
    	var weatherData = new Array();

      	result = JSON.parse(this.response);
      	data = result.product.time;

    	for (var i=0; i < data.length; i++) {

    		from[i] = new Date(data[i].from);
    		to[i] = new Date(data[i].to);


    		// Prévision h+1
    		if (from[i].getTime() === afterOneHour.getTime() && to[i].getTime() === afterOneHour.getTime()) {
    			weatherData['nextHourWeather'] = data[i];
    		}

    		else if (from[i].getTime() === now.getTime() && to[i].getTime() === afterOneHour.getTime()) {
    			weatherData['nextHourWeatherBis'] = data[i];
    		}

    		// Prévision J+1 matin (entre 6h et 12h)
    		else if (from[i].getTime() === tomorrow06.getTime() && to[i].getTime() === tomorrow12.getTime()) {
    			weatherData['tomorrowAMWeather'] = data[i];
    		}

    		// Prévision J+1 après-midi (entre 12h et 18h)
    		else if (from[i].getTime() === tomorrow12.getTime() && to[i].getTime() === tomorrow18.getTime()) {
    			weatherData['tomorrowPMWeather'] = data[i];
    		}

    	}

    		//### 1. Récupérer la météo pour l'heure actuelle
            currentWeather = Object.assign(currentWeather, nextHourWeather);

    		//### 2. Récupérer la météo pour l'heure d'après

            nextHourWeather.from = weatherData['nextHourWeatherBis'].from;
    		nextHourWeather.to = weatherData['nextHourWeatherBis'].to;
    		nextHourWeather.temp = weatherData['nextHourWeather'].location.temperature.value;
    		nextHourWeather.windSpeed = weatherData['nextHourWeather'].location.windSpeed.mps;
            nextHourWeather.humidity = weatherData['nextHourWeather'].location.humidity.value;
    		nextHourWeather.rain = weatherData['nextHourWeatherBis'].location.precipitation.value;
    		nextHourWeather.symbol = weatherData['nextHourWeatherBis'].location.symbol.number;
    		nextHourWeather.tempText = weatherData['nextHourWeatherBis'].location.symbol.id;

            //### Si currentWeather est vide (i.e. premier refresh de la page), on attribue les valeurs de l'heure d'après
    		if (typeof currentWeather.from == 'undefined' && typeof currentWeather.to == 'undefined') {
    			currentWeather = Object.assign(currentWeather, nextHourWeather);
    		}

    		//### 3. Récupérer la météo pour demain matin

    		tomorrowAMWeather.from = weatherData['tomorrowAMWeather'].from;
    		tomorrowAMWeather.to = weatherData['tomorrowAMWeather'].to;
    		tomorrowAMWeather.tempMin = weatherData['tomorrowAMWeather'].location.minTemperature.value;
    		tomorrowAMWeather.tempMax = weatherData['tomorrowAMWeather'].location.maxTemperature.value;
    		tomorrowAMWeather.rain = weatherData['tomorrowAMWeather'].location.precipitation.value;
    		tomorrowAMWeather.symbol = weatherData['tomorrowAMWeather'].location.symbol.number;
    		tomorrowAMWeather.tempText = weatherData['tomorrowAMWeather'].location.symbol.id;


    		//### 4. Récupérer la météo pour demain après-midi

    		tomorrowPMWeather.from = weatherData['tomorrowPMWeather'].from;
    		tomorrowPMWeather.to = weatherData['tomorrowPMWeather'].to;
    		tomorrowPMWeather.tempMin = weatherData['tomorrowPMWeather'].location.minTemperature.value;
    		tomorrowPMWeather.tempMax = weatherData['tomorrowPMWeather'].location.maxTemperature.value;
    		tomorrowPMWeather.rain = weatherData['tomorrowPMWeather'].location.precipitation.value;
    		tomorrowPMWeather.symbol = weatherData['tomorrowPMWeather'].location.symbol.number;
    		tomorrowPMWeather.tempText = weatherData['tomorrowPMWeather'].location.symbol.id;

        setWeatherIcon("currentWeather", currentWeather.symbol);
    	document.getElementById('currentWeather').getElementsByClassName('tempText')[0].innerHTML = translateTempText(currentWeather.symbol);
    	document.getElementById('currentWeather').getElementsByClassName('temp')[0].innerHTML = currentWeather.temp+"°";
    	document.getElementById('currentWeather').getElementsByClassName('rain')[0].innerHTML = Math.round(currentWeather.rain)+" mm";
        document.getElementById('currentWeather').getElementsByClassName('humidity')[0].innerHTML = Math.round(currentWeather.humidity)+"%";
    	document.getElementById('currentWeather').getElementsByClassName('windSpeed')[0].innerHTML = Math.round(speedMstoKmh(currentWeather.windSpeed), 0)+" km/h";

        setWeatherIcon("nextHourWeather", nextHourWeather.symbol);
    	document.getElementById('nextHourWeather').getElementsByClassName('tempText')[0].innerHTML = translateTempText(nextHourWeather.symbol);
    	document.getElementById('nextHourWeather').getElementsByClassName('temp')[0].innerHTML = nextHourWeather.temp+"°";
    	document.getElementById('nextHourWeather').getElementsByClassName('rain')[0].innerHTML = Math.round(nextHourWeather.rain)+" mm";
        document.getElementById('nextHourWeather').getElementsByClassName('humidity')[0].innerHTML = Math.round(nextHourWeather.humidity)+"%";
    	document.getElementById('nextHourWeather').getElementsByClassName('windSpeed')[0].innerHTML = Math.round(speedMstoKmh(nextHourWeather.windSpeed), 0)+" km/h";

        setWeatherIcon("tomorrowAMWeather", tomorrowAMWeather.symbol);
    	document.getElementById('tomorrowAMWeather').getElementsByClassName('tempText')[0].innerHTML = translateTempText(tomorrowAMWeather.symbol);
    	document.getElementById('tomorrowAMWeather').getElementsByClassName('tempMin')[0].innerHTML = tomorrowAMWeather.tempMin+"°";
    	document.getElementById('tomorrowAMWeather').getElementsByClassName('tempMax')[0].innerHTML = tomorrowAMWeather.tempMax+"°";

        setWeatherIcon("tomorrowPMWeather", tomorrowPMWeather.symbol);
    	document.getElementById('tomorrowPMWeather').getElementsByClassName('tempText')[0].innerHTML = translateTempText(tomorrowPMWeather.symbol);
    	document.getElementById('tomorrowPMWeather').getElementsByClassName('tempMin')[0].innerHTML = tomorrowPMWeather.tempMin+"°";
    	document.getElementById('tomorrowPMWeather').getElementsByClassName('tempMax')[0].innerHTML = tomorrowPMWeather.tempMax+"°";

      } else {
        console.log('error');
      }
    };

    return request.send();
}

refreshMeteo();
setInterval("refreshMeteo()", 1800000); // refresh toutes les 30 minutes

function loadSlide() {
    return document.getElementById("googleSlide").src = "https://docs.google.com/presentation/d/e/2PACX-1vQoELt5p3el0Z4v0TOCFjnJCucY8PEZGpSgtZprx8zM1eFt-SpVmP3XuBGIufALVohhtb2MXg7KV3l2/embed?start=true&loop=true&delayms=3000&rm=minimal";
}

loadSlide();
setInterval("loadSlide()", 300000); // refresh toutes les 5 minutes

</script>
</body>
</html>
